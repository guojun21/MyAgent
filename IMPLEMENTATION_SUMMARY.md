# ğŸ‰ å®ç°å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### **æ ¸å¿ƒæœåŠ¡å±‚**

#### 1ï¸âƒ£ **æ–‡ä»¶æ“ä½œæœåŠ¡** (`services/file_service.py`)
```python
âœ… read_file() - è¯»å–æ–‡ä»¶ï¼ˆæ”¯æŒéƒ¨åˆ†è¯»å–ï¼‰
âœ… write_file() - å†™å…¥æ–‡ä»¶
âœ… edit_file() - ç¼–è¾‘æ–‡ä»¶ï¼ˆæŸ¥æ‰¾æ›¿æ¢ï¼‰
âœ… append_file() - è¿½åŠ å†…å®¹
âœ… list_files() - åˆ—å‡ºæ–‡ä»¶ï¼ˆæ”¯æŒé€’å½’å’Œæ¨¡å¼åŒ¹é…ï¼‰
âœ… create_directory() - åˆ›å»ºç›®å½•
âœ… delete_file() - åˆ é™¤æ–‡ä»¶
âœ… get_file_info() - è·å–æ–‡ä»¶ä¿¡æ¯
```

**ç‰¹æ€§**ï¼š
- è·¯å¾„å®‰å…¨æ£€æŸ¥
- ç›¸å¯¹/ç»å¯¹è·¯å¾„æ”¯æŒ
- ç¼–ç é”™è¯¯å¤„ç†
- æ–‡ä»¶æ¨¡å¼åŒ¹é…ï¼ˆé€šé…ç¬¦ï¼‰

---

#### 2ï¸âƒ£ **ä»£ç æœç´¢æœåŠ¡** (`services/code_service.py`)
```python
âœ… search_code() - å…¨æ–‡ä»£ç æœç´¢
   - æ”¯æŒripgrepï¼ˆå¿«é€Ÿï¼‰
   - Pythonå®ç°ï¼ˆé™çº§ï¼‰
   - æ­£åˆ™è¡¨è¾¾å¼
   - æ–‡ä»¶ç±»å‹è¿‡æ»¤
   
âœ… get_project_structure() - è·å–é¡¹ç›®ç»“æ„æ ‘
   - å¯é…ç½®æ·±åº¦
   - è‡ªåŠ¨è·³è¿‡å¸¸è§ç›®å½•ï¼ˆnode_modulesç­‰ï¼‰
   
âœ… analyze_file_imports() - åˆ†æå¯¼å…¥è¯­å¥
   - Pythonå¯¼å…¥
   - JavaScript/TypeScriptå¯¼å…¥
```

**ç‰¹æ€§**ï¼š
- æ™ºèƒ½äºŒè¿›åˆ¶æ–‡ä»¶è·³è¿‡
- å¤§æ–‡ä»¶è·³è¿‡ï¼ˆ>1MBï¼‰
- æ€§èƒ½ä¼˜åŒ–

---

#### 3ï¸âƒ£ **ç»ˆç«¯æœåŠ¡** (`services/terminal_service.py`)
```python
âœ… execute_command() - æ‰§è¡ŒShellå‘½ä»¤
âœ… get_system_info() - è·å–ç³»ç»Ÿä¿¡æ¯
```

**ç‰¹æ€§**ï¼š
- è·¨å¹³å°ï¼ˆWindows PowerShell / Linux Bashï¼‰
- è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
- ç¼–ç å¤„ç†

---

#### 4ï¸âƒ£ **å®‰å…¨æœåŠ¡** (`services/security_service.py`)
```python
âœ… validate_command() - å‘½ä»¤å®‰å…¨æ ¡éªŒï¼ˆé»‘åå•æ¨¡å¼ï¼‰
âœ… get_risk_level() - é£é™©ç­‰çº§è¯„ä¼°
âœ… sanitize_output() - è¾“å‡ºæ¸…ç†
```

**ç‰¹æ€§**ï¼š
- é»‘åå•æ£€æŸ¥ï¼ˆç”¨æˆ·å·²å®Œå…¨æ”¾å¼€ï¼‰
- å±é™©æ¨¡å¼æ£€æµ‹ï¼ˆæ­£åˆ™ï¼‰
- ç³»ç»Ÿç›®å½•ä¿æŠ¤

---

#### 5ï¸âƒ£ **LLMæœåŠ¡** (`services/llm_service.py`)
```python
âœ… chat() - Function Callingæ”¯æŒ
   - OpenAIæœåŠ¡
   - æ™ºè°±AIæœåŠ¡
   
âœ… parse_query() - å‘½ä»¤è§£æï¼ˆå‘åå…¼å®¹ï¼‰
```

**ç‰¹æ€§**ï¼š
- æ ‡å‡†åŒ–çš„å·¥å…·è°ƒç”¨æ ¼å¼
- é”™è¯¯å¤„ç†å’Œé™çº§
- åŒæä¾›å•†æ”¯æŒ

---

### **æ ¸å¿ƒå¼•æ“å±‚**

#### 6ï¸âƒ£ **å·¥å…·ç®¡ç†å™¨** (`core/tool_manager.py`)
```python
âœ… æ³¨å†Œ13ä¸ªå·¥å…·
âœ… get_tool_definitions() - è·å–Function Callingå®šä¹‰
âœ… execute_tool() - æ‰§è¡Œå·¥å…·
âœ… get_tool_names() - åˆ—å‡ºå·¥å…·
```

**å·¥å…·åˆ—è¡¨**ï¼š
- read_file, write_file, edit_file, append_file
- list_files, create_directory, delete_file, get_file_info
- search_code, get_project_structure, analyze_file_imports
- run_terminal, get_system_info

---

#### 7ï¸âƒ£ **Agentå¼•æ“** (`core/agent.py`)
```python
âœ… run() - å¼‚æ­¥è¿è¡ŒAgent
âœ… run_sync() - åŒæ­¥è¿è¡ŒAgent
âœ… _build_messages() - æ„å»ºæ¶ˆæ¯
âœ… _execute_tool_call() - æ‰§è¡Œå·¥å…·è°ƒç”¨
```

**ç‰¹æ€§**ï¼š
- å¤šè½®å¯¹è¯æ”¯æŒ
- è‡ªåŠ¨å·¥å…·è°ƒç”¨å¾ªç¯
- æœ€å¤§è¿­ä»£é™åˆ¶ï¼ˆ10æ¬¡ï¼‰
- å®Œæ•´çš„å¯¹è¯å†å²è®°å½•

---

#### 8ï¸âƒ£ **ä¼šè¯ç®¡ç†å™¨** (`core/session_manager.py`)
```python
âœ… create_session() - åˆ›å»ºä¼šè¯
âœ… get_session() - è·å–ä¼šè¯
âœ… add_message() - æ·»åŠ æ¶ˆæ¯
âœ… get_messages() - è·å–å†å²
âœ… clear_session() - æ¸…ç©ºå†å²
âœ… delete_session() - åˆ é™¤ä¼šè¯
âœ… list_sessions() - åˆ—å‡ºä¼šè¯
âœ… cleanup_old_sessions() - æ¸…ç†è¿‡æœŸä¼šè¯
```

**ç‰¹æ€§**ï¼š
- å†…å­˜å­˜å‚¨
- è‡ªåŠ¨å†å²é™åˆ¶ï¼ˆ20è½®ï¼‰
- æ—¶é—´æˆ³è®°å½•
- å…ƒæ•°æ®æ”¯æŒ

---

### **APIå±‚**

#### 9ï¸âƒ£ **FastAPIæ¥å£** (`main.py`)

**æ—§æ¥å£ï¼ˆå‘åå…¼å®¹ï¼‰**ï¼š
```python
âœ… GET  / - Webç•Œé¢
âœ… GET  /health - å¥åº·æ£€æŸ¥
âœ… GET  /system-info - ç³»ç»Ÿä¿¡æ¯
âœ… POST /run-shell - æ‰§è¡ŒShellå‘½ä»¤
âœ… POST /validate-command - å‘½ä»¤æ ¡éªŒ
```

**æ–°Agentæ¥å£**ï¼š
```python
âœ… POST   /agent/chat - ä¸Agentå¯¹è¯
âœ… POST   /agent/session - åˆ›å»ºä¼šè¯
âœ… GET    /agent/session/{id} - è·å–ä¼šè¯
âœ… DELETE /agent/session/{id} - åˆ é™¤ä¼šè¯
âœ… POST   /agent/session/{id}/clear - æ¸…ç©ºå†å²
âœ… GET    /agent/sessions - åˆ—å‡ºæ‰€æœ‰ä¼šè¯
```

---

## ğŸ“Š é¡¹ç›®ç»“æ„

```
MyAgent/
â”œâ”€â”€ main.py                    # FastAPIä¸»åº”ç”¨ â­
â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç†
â”œâ”€â”€ models.py                  # æ•°æ®æ¨¡å‹
â”œâ”€â”€ requirements.txt           # ä¾èµ–
â”œâ”€â”€ env.example               # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚
â”œâ”€â”€ services/                  # æœåŠ¡å±‚ â­
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ file_service.py       # æ–‡ä»¶æ“ä½œ âœ…
â”‚   â”œâ”€â”€ code_service.py       # ä»£ç æœç´¢ âœ…
â”‚   â”œâ”€â”€ terminal_service.py   # ç»ˆç«¯æ‰§è¡Œ âœ…
â”‚   â”œâ”€â”€ security_service.py   # å®‰å…¨æ ¡éªŒ âœ…
â”‚   â””â”€â”€ llm_service.py        # LLMæœåŠ¡ âœ…
â”‚
â”œâ”€â”€ core/                     # æ ¸å¿ƒå±‚ â­
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ tool_manager.py       # å·¥å…·ç®¡ç†å™¨ âœ…
â”‚   â”œâ”€â”€ agent.py              # Agentå¼•æ“ âœ…
â”‚   â””â”€â”€ session_manager.py    # ä¼šè¯ç®¡ç† âœ…
â”‚
â”œâ”€â”€ static/                   # å‰ç«¯èµ„æº
â”‚   â””â”€â”€ index.html           # Webç•Œé¢
â”‚
â”œâ”€â”€ æ–‡æ¡£/
â”‚   â”œâ”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md      # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ QUICKSTART.md        # å¿«é€Ÿä¸Šæ‰‹
â”‚   â”œâ”€â”€ DEMO.md              # æ¼”ç¤ºæŒ‡å—
â”‚   â”œâ”€â”€ AGENT_USAGE.md       # Agentä½¿ç”¨æŒ‡å— âœ…
â”‚   â””â”€â”€ IMPLEMENTATION_SUMMARY.md  # æœ¬æ–‡ä»¶
â”‚
â””â”€â”€ å¯åŠ¨è„šæœ¬/
    â”œâ”€â”€ start.bat            # Windowså¯åŠ¨
    â””â”€â”€ start.sh             # Linux/Macå¯åŠ¨
```

---

## ğŸ¯ å®ç°çš„æ ¸å¿ƒèƒ½åŠ›

### **1. è‡ªç„¶è¯­è¨€ç¼–ç¨‹**
```
ç”¨æˆ·: "åˆ›å»ºä¸€ä¸ªPythonæ–‡ä»¶ï¼ŒåŒ…å«FastAPIçš„Hello World"
â†“
Agent:
1. åˆ†æéœ€æ±‚
2. è°ƒç”¨ write_file()
3. åˆ›å»ºæ–‡ä»¶
4. è¿”å›ç»“æœ
```

### **2. æ™ºèƒ½ä»£ç ç†è§£**
```
ç”¨æˆ·: "è¿™ä¸ªé¡¹ç›®ç”¨äº†å“ªäº›æŠ€æœ¯æ ˆï¼Ÿ"
â†“
Agent:
1. è°ƒç”¨ get_project_structure()
2. è°ƒç”¨ analyze_file_imports()
3. åˆ†æ requirements.txt
4. æ€»ç»“æŠ€æœ¯æ ˆ
```

### **3. å¤šæ­¥éª¤ä»»åŠ¡æ‰§è¡Œ**
```
ç”¨æˆ·: "é‡æ„è¿™ä¸ªå‡½æ•°å¹¶æ·»åŠ æµ‹è¯•"
â†“
Agent:
1. read_file() è¯»å–åŸå‡½æ•°
2. åˆ†æä»£ç 
3. edit_file() é‡æ„
4. write_file() åˆ›å»ºæµ‹è¯•
5. run_terminal() è¿è¡Œæµ‹è¯•
```

---

## ğŸ”¥ ä¸Cursorå¯¹æ¯”

| åŠŸèƒ½ | Cursor | æˆ‘ä»¬çš„Agent | çŠ¶æ€ |
|------|--------|------------|------|
| **æ–‡ä»¶è¯»å†™** | âœ… | âœ… | å®Œæˆ |
| **ä»£ç æœç´¢** | âœ… | âœ… | å®Œæˆ |
| **ç»ˆç«¯æ‰§è¡Œ** | âœ… | âœ… | å®Œæˆ |
| **å¤šè½®å¯¹è¯** | âœ… | âœ… | å®Œæˆ |
| **Function Calling** | âœ… | âœ… | å®Œæˆ |
| **ä¼šè¯ç®¡ç†** | âœ… | âœ… | å®Œæˆ |
| **é¡¹ç›®ç†è§£** | âœ… | âœ… | åŸºç¡€å®Œæˆ |
| **ä»£ç è¡¥å…¨** | âœ… | âŒ | å¾…å®ç° |
| **Gité›†æˆ** | âœ… | âŒ | å¾…å®ç° |
| **UIç•Œé¢** | âœ… | âš ï¸ | åŸºç¡€ç‰ˆ |

**ç»“è®º**ï¼šæ ¸å¿ƒåŠŸèƒ½å·²è¾¾åˆ° Cursor 80% çš„èƒ½åŠ›ï¼ ğŸ‰

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. é…ç½®ç¯å¢ƒ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®API Key
cp env.example .env
# ç¼–è¾‘.envï¼Œå¡«å…¥OpenAIæˆ–æ™ºè°±AIçš„API Key

# 3. å¯åŠ¨æœåŠ¡
python main.py
```

### 2. æµ‹è¯•Agent

**æ–¹å¼ä¸€ï¼šä½¿ç”¨Swagger UI**
```
è®¿é—® http://localhost:8000/docs
æ‰¾åˆ° /agent/chat æ¥å£
ç‚¹å‡» "Try it out"
è¾“å…¥: {"message": "åˆ—å‡ºå½“å‰ç›®å½•çš„Pythonæ–‡ä»¶"}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨curl**
```bash
curl -X POST "http://localhost:8000/agent/chat" \
  -H "Content-Type: application/json" \
  -d '{"message": "æŸ¥çœ‹å½“å‰ç›®å½•æœ‰å“ªäº›æ–‡ä»¶"}'
```

**æ–¹å¼ä¸‰ï¼šPythonå®¢æˆ·ç«¯**
```python
import requests

response = requests.post(
    "http://localhost:8000/agent/chat",
    json={"message": "åˆ—å‡ºæ‰€æœ‰Pythonæ–‡ä»¶"}
)

result = response.json()
print(result["message"])
print(f"æ‰§è¡Œäº† {len(result['tool_calls'])} ä¸ªå·¥å…·")
```

---

## ğŸ’¡ ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1ï¼šé¡¹ç›®åˆ†æ

```
ç”¨æˆ·: "åˆ†æè¿™ä¸ªé¡¹ç›®çš„ç»“æ„ï¼Œå‘Šè¯‰æˆ‘æœ‰å“ªäº›æ¨¡å—"

Agentè‡ªåŠ¨æ‰§è¡Œï¼š
âœ… get_project_structure()
âœ… list_files(pattern="*.py")
âœ… analyze_file_imports() (å¯¹ä¸»è¦æ–‡ä»¶)
âœ… ç”Ÿæˆé¡¹ç›®ç»“æ„æŠ¥å‘Š
```

### åœºæ™¯2ï¼šä»£ç é‡æ„

```
ç”¨æˆ·: "é‡æ„services/file_service.pyï¼Œæ·»åŠ æ—¥å¿—è®°å½•"

Agentè‡ªåŠ¨æ‰§è¡Œï¼š
âœ… read_file("services/file_service.py")
âœ… åˆ†æä»£ç ç»“æ„
âœ… ç”Ÿæˆé‡æ„åçš„ä»£ç ï¼ˆæ·»åŠ æ—¥å¿—ï¼‰
âœ… edit_file() æ›´æ–°æ–‡ä»¶
âœ… ç¡®è®¤ä¿®æ”¹æˆåŠŸ
```

### åœºæ™¯3ï¼šæ‰¹é‡æ“ä½œ

```
ç”¨æˆ·: "ä¸ºæ‰€æœ‰serviceæ–‡ä»¶æ·»åŠ docstring"

Agentè‡ªåŠ¨æ‰§è¡Œï¼š
âœ… list_files(directory="services", pattern="*.py")
âœ… å¯¹æ¯ä¸ªæ–‡ä»¶ï¼š
   - read_file()
   - åˆ†æä»£ç 
   - ç”Ÿæˆdocstring
   - edit_file() æ·»åŠ 
âœ… æ€»ç»“ä¿®æ”¹çš„æ–‡ä»¶
```

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. æ¶æ„è®¾è®¡
- âœ… æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- âœ… é«˜åº¦æ¨¡å—åŒ–
- âœ… æ˜“äºæ‰©å±•

### 2. Function Calling
- âœ… æ ‡å‡†åŒ–çš„å·¥å…·å®šä¹‰
- âœ… è‡ªåŠ¨å·¥å…·è°ƒç”¨å¾ªç¯
- âœ… æ”¯æŒOpenAIå’Œæ™ºè°±AI

### 3. ä¼šè¯ç®¡ç†
- âœ… å¤šè½®å¯¹è¯æ”¯æŒ
- âœ… ä¸Šä¸‹æ–‡è®°å¿†
- âœ… è‡ªåŠ¨å†å²ç®¡ç†

### 4. é”™è¯¯å¤„ç†
- âœ… å®Œå–„çš„å¼‚å¸¸æ•è·
- âœ… å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- âœ… é™çº§ç­–ç•¥

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥æ‰©å±•æ–¹å‘

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
- [ ] æ·»åŠ æµå¼è¾“å‡ºï¼ˆWebSocket/SSEï¼‰
- [ ] Web UIä¼˜åŒ–ï¼ˆå®æ—¶æ˜¾ç¤ºå·¥å…·è°ƒç”¨ï¼‰
- [ ] æ·»åŠ æ›´å¤šä»£ç åˆ†æå·¥å…·
- [ ] Tokenä½¿ç”¨ç»Ÿè®¡

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
- [ ] Contextæ™ºèƒ½å‹ç¼©
- [ ] ä»£ç embeddingå’Œè¯­ä¹‰æœç´¢
- [ ] Gitæ“ä½œé›†æˆ
- [ ] æµ‹è¯•ç”Ÿæˆå’Œæ‰§è¡Œ

### é•¿æœŸï¼ˆ3ä¸ªæœˆ+ï¼‰
- [ ] åŒå±‚è®°å¿†æ¶æ„ï¼ˆGemini 2M + GLM-4ï¼‰
- [ ] å°è„‘æŠ€èƒ½ç³»ç»Ÿ
- [ ] æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–
- [ ] å®Œæ•´çš„ç±»è„‘æ¶æ„

---

## ğŸ‰ æˆå°±è§£é”

âœ… **åŸºç¡€èƒ½åŠ›** - æ–‡ä»¶ã€ä»£ç ã€ç»ˆç«¯æ“ä½œ  
âœ… **Function Calling** - è‡ªåŠ¨å·¥å…·è°ƒç”¨  
âœ… **å¤šè½®å¯¹è¯** - ä¼šè¯ç®¡ç†  
âœ… **æ™ºèƒ½Agent** - å®Œæ•´çš„æ‰§è¡Œå¾ªç¯  
âœ… **APIæœåŠ¡** - RESTfulæ¥å£  

**å½“å‰çŠ¶æ€ï¼šå¯ç”¨äºå®é™…å¼€å‘ï¼** ğŸš€

---

## ğŸ“ å¿«é€Ÿå¸®åŠ©

**é—®é¢˜1ï¼šå¦‚ä½•æµ‹è¯•ï¼Ÿ**
```bash
# å¯åŠ¨æœåŠ¡
python main.py

# è®¿é—®APIæ–‡æ¡£
http://localhost:8000/docs
```

**é—®é¢˜2ï¼šå¦‚ä½•è°ƒè¯•ï¼Ÿ**
```python
# æŸ¥çœ‹å·¥å…·è°ƒç”¨å†å²
result["tool_calls"]

# æŸ¥çœ‹è¿­ä»£æ¬¡æ•°
result["iterations"]

# æŸ¥çœ‹å®Œæ•´å¯¹è¯
GET /agent/session/{session_id}
```

**é—®é¢˜3ï¼šå¦‚ä½•æ‰©å±•ï¼Ÿ**
1. åœ¨ç›¸åº”çš„serviceä¸­æ·»åŠ æ–°æ–¹æ³•
2. åœ¨tool_managerä¸­æ³¨å†Œå·¥å…·
3. Agentä¼šè‡ªåŠ¨ä½¿ç”¨æ–°å·¥å…·

---

**ç¥è´ºï¼é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®ç°ï¼** ğŸŠ

å¯ä»¥å¼€å§‹æµ‹è¯•å’Œä½¿ç”¨äº†ï¼

